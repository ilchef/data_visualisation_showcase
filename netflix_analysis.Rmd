---
title: "Film and TV ratings"
author: "Tom Ilchef"
date: "21/08/2021"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r,message=FALSE,warning=FALSE,echo=FALSE}
library(ggplot2)
library(dplyr)
library(shiny)
library(lubridate)
library(forcats)
library(plotly)
library(ggpubr)
library(stringr)
```

```{r,message=FALSE,warning=FALSE,echo=FALSE}
df <- "netflix-rotten-tomatoes-metacritic-imdb.csv"%>%read.csv()
```


```{r,message=FALSE,warning=FALSE,echo=FALSE}
df <- df %>%
        mutate(Release.Date = as.Date(Release.Date,format="%d-%b-%y")
               , Release.Date = case_when(Release.Date > "2021-08-20" ~ Release.Date%m-% months(1200),TRUE~ Release.Date)
               , Decade = year(Release.Date) - year(Release.Date)%%10
               , Boxoffice= as.numeric(gsub("\\D+", "", Boxoffice))) 
```



```{r,message=FALSE,warning=FALSE,echo=FALSE}
theme_aes = function(){
        theme(
                panel.grid.major = element_blank()
                , panel.grid.minor = element_blank()
                , axis.title = element_text(color="black")
                , axis.title.x = element_blank()
                , axis.text.x = element_text(color="black")
                , axis.text.y = element_text(color="black")
                , plot.background = element_rect(fill="#f0f0f0",color="#b4b4b4")
                , panel.background = element_blank()
                , axis.line.x = element_line(color="black")
                , axis.line.y = element_line(color="black")
        )
}
```

# Relationship between Critic Rating and Revenue, by Decade
### Among english-language movies, moderate positive correlation between a films critical rating and box office revenue.
```{r,warning=FALSE,message=FALSE,echo=FALSE,fig.width=9,fig.asp=0.6}
ggplotly(
        df %>%
        filter(!is.na(Boxoffice)&!is.na(Decade))%>%
        filter(!Decade %in% c("1930","1940","1950","1960")) %>%
        filter(Languages=="English")%>% 
        mutate(Boxoffice=Boxoffice/1e6)%>%
        ggplot(aes(x=IMDb.Score,y=Boxoffice))+
        geom_point(aes(text=Title),size=2,alpha=0.3,color = "#DB5461")+
        geom_smooth(method='lm',colour="#3D5467",se=F,alpha=0.5,linetype="dotted",size=0.6)+
        theme_aes()+
        facet_wrap(~Decade)+
        theme_aes()+
        theme(plot.background = element_rect(fill="#f0f0f0",color="#b4b4b4"))
        )%>%layout(plot_bgcolor='rgba(0,0,0,0)')
```


# Film rating distribution, over time, by rating site.
### Little clear consensus between sites, likely reflecting differences in rated populations, and of course the subjectivity of ratings. 

### There does seem to be a broad consensus that films were best in the early 20th century, and begin declining in quality after the 60s, with a possible uptick starting around the 2010's.

```{r,echo=FALSE,message=FALSE,warning=FALSE,fig.width=11,fig.asp=0.6}
source("r/violin_rating_by_time.R")

violin_imdb <- violin_rating_by_time(df=df
                                 ,var="IMDb.Score"
                                 ,color="#DB5461"
                                 ,title="Distribution of IMDb Scores by Decade")

violin_hg <- violin_rating_by_time(df=df
                                 ,var="Hidden.Gem.Score"
                                 ,color="#3D5467"
                                 ,title="Distribution of Hidden Gem Scores by Decade")

violin_mc <- violin_rating_by_time(df=df
                                 ,var="Metacritic.Score"
                                 ,color="#686963"
                                 ,title="Distribution of Metacritic Scores by Decade")
violin_rt <- violin_rating_by_time(df=df
                                 ,var="Rotten.Tomatoes.Score"
                                 ,color="#8AA29E"
                                 ,title="Distribution of Rotten Tomatoes Scores by Decade")

violin <- ggarrange(violin_imdb,violin_hg,violin_mc,violin_rt) +
        theme_aes()+
        theme(plot.background = element_rect(fill="#f0f0f0",color="#b4b4b4"))
violin
```







